---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout title="Reservas - Kali Club">
    <Header />
    
    <main class="reservations-page">
        <section class="reservations-hero">
            <div class="container">
                <h1 class="page-title">Reservas</h1>
                <p class="page-subtitle">Asegura tu mesa y vive una experiencia VIP inolvidable</p>
            </div>
        </section>

        <section class="reservations-content">
            <div class="container">
                <div class="reservations-grid">
                    <!-- Reservation Form -->
                    <div class="reservation-form-section">
                        <div class="form-header">
                            <h2 class="form-title">Reserva tu Mesa</h2>
                            <p class="form-subtitle">Completa el formulario y confirmaremos tu reserva</p>
                        </div>
                        
                        <form class="reservation-form" id="reservation-form">
                            <div class="form-step active" data-step="1">
                                <h3 class="step-title">Información Personal</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Nombre *</label>
                                        <input type="text" class="form-input" name="firstName" required placeholder="Tu nombre">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Apellido *</label>
                                        <input type="text" class="form-input" name="lastName" required placeholder="Tu apellido">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Email *</label>
                                    <input type="email" class="form-input" name="email" required placeholder="tu@email.com">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Teléfono *</label>
                                    <input type="tel" class="form-input" name="phone" required placeholder="+1 234 567 8900">
                                </div>
                            </div>

                            <div class="form-step" data-step="2">
                                <h3 class="step-title">Detalles de la Reserva</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Fecha *</label>
                                        <input type="date" class="form-input" name="date" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Hora *</label>
                                        <select class="form-select" name="time" required>
                                            <option value="">Selecciona hora</option>
                                            <option value="21:00">9:00 PM</option>
                                            <option value="21:30">9:30 PM</option>
                                            <option value="22:00">10:00 PM</option>
                                            <option value="22:30">10:30 PM</option>
                                            <option value="23:00">11:00 PM</option>
                                            <option value="23:30">11:30 PM</option>
                                            <option value="00:00">12:00 AM</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Número de Personas *</label>
                                        <select class="form-select" name="guests" required>
                                            <option value="">Selecciona cantidad</option>
                                            <option value="2">2 personas</option>
                                            <option value="4">4 personas</option>
                                            <option value="6">6 personas</option>
                                            <option value="8">8 personas</option>
                                            <option value="10">10 personas</option>
                                            <option value="12+">Más de 12 personas</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Tipo de Mesa *</label>
                                        <select class="form-select" name="tableType" required>
                                            <option value="">Selecciona tipo</option>
                                            <option value="regular" data-price="50">Mesa Regular - $50</option>
                                            <option value="vip" data-price="150">Mesa VIP - $150</option>
                                            <option value="premium" data-price="300">Mesa Premium - $300</option>
                                            <option value="private" data-price="500">Área Privada - $500</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Ocasión Especial</label>
                                    <select class="form-select" name="occasion">
                                        <option value="">Selecciona ocasión</option>
                                        <option value="cumpleanos">Cumpleaños</option>
                                        <option value="aniversario">Aniversario</option>
                                        <option value="despedida">Despedida</option>
                                        <option value="celebracion">Celebración</option>
                                        <option value="cita">Cita Romántica</option>
                                        <option value="negocios">Reunión de Negocios</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-step" data-step="3">
                                <h3 class="step-title">Servicios Adicionales</h3>
                                
                                <div class="services-grid">
                                    <label class="service-option">
                                        <input type="checkbox" name="services" value="bottle-service" data-price="200">
                                        <div class="service-card">
                                            <div class="service-icon">🍾</div>
                                            <h4 class="service-name">Bottle Service</h4>
                                            <p class="service-description">Servicio de botella premium</p>
                                            <span class="service-price">+$200</span>
                                        </div>
                                    </label>
                                    
                                    <label class="service-option">
                                        <input type="checkbox" name="services" value="birthday-package" data-price="100">
                                        <div class="service-card">
                                            <div class="service-icon">🎂</div>
                                            <h4 class="service-name">Paquete Cumpleaños</h4>
                                            <p class="service-description">Decoración y pastel</p>
                                            <span class="service-price">+$100</span>
                                        </div>
                                    </label>
                                    
                                    <label class="service-option">
                                        <input type="checkbox" name="services" value="photographer" data-price="150">
                                        <div class="service-card">
                                            <div class="service-icon">📸</div>
                                            <h4 class="service-name">Fotógrafo</h4>
                                            <p class="service-description">Sesión fotográfica profesional</p>
                                            <span class="service-price">+$150</span>
                                        </div>
                                    </label>
                                    
                                    <label class="service-option">
                                        <input type="checkbox" name="services" value="vip-transport" data-price="80">
                                        <div class="service-card">
                                            <div class="service-icon">🚗</div>
                                            <h4 class="service-name">Transporte VIP</h4>
                                            <p class="service-description">Traslado en vehículo de lujo</p>
                                            <span class="service-price">+$80</span>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Comentarios Especiales</label>
                                    <textarea class="form-textarea" name="comments" placeholder="Alguna solicitud especial..."></textarea>
                                </div>
                            </div>

                            <div class="form-navigation">
                                <button type="button" class="btn-prev" id="btn-prev">Anterior</button>
                                <div class="step-indicators">
                                    <span class="step-indicator active" data-step="1"></span>
                                    <span class="step-indicator" data-step="2"></span>
                                    <span class="step-indicator" data-step="3"></span>
                                </div>
                                <button type="button" class="btn-next" id="btn-next">Siguiente</button>
                                <button type="submit" class="btn-submit" id="btn-submit" style="display: none;">
                                    Confirmar Reserva
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Reservation Summary -->
                    <div class="reservation-summary">
                        <div class="summary-card">
                            <h3 class="summary-title">Resumen de Reserva</h3>
                            
                            <div class="summary-details" id="summary-details">
                                <p class="summary-placeholder">Completa el formulario para ver el resumen</p>
                            </div>
                            
                            <div class="price-breakdown" id="price-breakdown" style="display: none;">
                                <div class="price-item">
                                    <span>Mesa:</span>
                                    <span id="table-price">$0</span>
                                </div>
                                <div class="price-item">
                                    <span>Servicios adicionales:</span>
                                    <span id="services-price">$0</span>
                                </div>
                                <div class="price-item">
                                    <span>Impuestos (10%):</span>
                                    <span id="tax-price">$0</span>
                                </div>
                                <div class="price-item total">
                                    <span>Total:</span>
                                    <span id="total-price">$0</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-cards">
                            <div class="info-card">
                                <h4 class="info-title">Política de Cancelación</h4>
                                <p class="info-text">
                                    Puedes cancelar tu reserva hasta 24 horas antes sin costo. 
                                    Cancelaciones tardías tienen un cargo del 50%.
                                </p>
                            </div>
                            
                            <div class="info-card">
                                <h4 class="info-title">Código de Vestimenta</h4>
                                <p class="info-text">
                                    Elegante casual. No se permite ropa deportiva, 
                                    sandalias o gorras.
                                </p>
                            </div>
                            
                            <div class="info-card">
                                <h4 class="info-title">Edad Mínima</h4>
                                <p class="info-text">
                                    Entrada solo para mayores de 18 años. 
                                    Se requiere identificación válida.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <Footer />
</Layout>

<style>
    .reservations-page {
        padding-top: 80px;
        min-height: 100vh;
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
        color: white;
    }

    .reservations-hero {
        padding: 4rem 0;
        text-align: center;
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                    url('/pictures/reservations/reservations-hero.jpg') center/cover;
    }

    .page-title {
        font-size: clamp(2.5rem, 5vw, 4rem);
        font-weight: 900;
        margin-bottom: 1rem;
        background: linear-gradient(45deg, #ff0080, #7928ca);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .page-subtitle {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.8);
        max-width: 600px;
        margin: 0 auto;
    }

    .reservations-content {
        padding: 6rem 0;
    }

    .reservations-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 4rem;
        align-items: start;
    }

    /* Form Styles */
    .reservation-form-section {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 3rem;
    }

    .form-header {
        margin-bottom: 2rem;
    }

    .form-title {
        font-size: 2rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        color: #ff0080;
    }

    .form-subtitle {
        color: rgba(255, 255, 255, 0.7);
    }

    .form-step {
        display: none;
    }

    .form-step.active {
        display: block;
    }

    .step-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 2rem;
        color: #7928ca;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.9);
    }

    .form-input,
    .form-select,
    .form-textarea {
        width: 100%;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 1rem;
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: #ff0080;
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 0 0 2px rgba(255, 0, 128, 0.2);
    }

    .form-textarea {
        resize: vertical;
        min-height: 100px;
    }

    .form-input::placeholder,
    .form-textarea::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    .form-select option {
        background: #1a1a1a;
        color: white;
    }

    .services-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .service-option {
        cursor: pointer;
    }

    .service-option input[type="checkbox"] {
        display: none;
    }

    .service-card {
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
    }

    .service-option input[type="checkbox"]:checked + .service-card {
        border-color: #ff0080;
        background: rgba(255, 0, 128, 0.1);
    }

    .service-card:hover {
        border-color: rgba(255, 0, 128, 0.5);
        transform: translateY(-2px);
    }

    .service-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
    }

    .service-name {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: white;
    }

    .service-description {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 1rem;
    }

    .service-price {
        font-size: 1rem;
        font-weight: 700;
        color: #ff0080;
    }

    .form-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-prev,
    .btn-next,
    .btn-submit {
        background: linear-gradient(45deg, #ff0080, #7928ca);
        border: none;
        border-radius: 12px;
        padding: 1rem 2rem;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-prev {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn-prev:hover,
    .btn-next:hover,
    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(255, 0, 128, 0.4);
    }

    .btn-prev:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .step-indicators {
        display: flex;
        gap: 0.5rem;
    }

    .step-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
    }

    .step-indicator.active {
        background: #ff0080;
    }

    /* Summary Styles */
    .reservation-summary {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .summary-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 2rem;
        position: sticky;
        top: 100px;
    }

    .summary-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: #ff0080;
    }

    .summary-details {
        margin-bottom: 2rem;
    }

    .summary-placeholder {
        color: rgba(255, 255, 255, 0.6);
        font-style: italic;
        text-align: center;
        padding: 2rem;
    }

    .price-breakdown {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 1.5rem;
    }

    .price-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }

    .price-item.total {
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        padding-top: 1rem;
        margin-top: 1rem;
        font-weight: 700;
        font-size: 1.1rem;
        color: #ff0080;
    }

    .info-cards {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .info-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .info-title {
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: #7928ca;
    }

    .info-text {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.5;
    }

    @media (max-width: 1024px) {
        .reservations-grid {
            grid-template-columns: 1fr;
            gap: 3rem;
        }

        .summary-card {
            position: static;
        }
    }

    @media (max-width: 768px) {
        .reservation-form-section {
            padding: 2rem;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .services-grid {
            grid-template-columns: 1fr;
        }

        .form-navigation {
            flex-direction: column;
            gap: 1rem;
        }

        .step-indicators {
            order: -1;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('reservation-form');
        const steps = document.querySelectorAll('.form-step');
        const stepIndicators = document.querySelectorAll('.step-indicator');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');
        const btnSubmit = document.getElementById('btn-submit');
        
        let currentStep = 1;
        const totalSteps = steps.length;

        // Update step visibility and navigation
        function updateStep() {
            steps.forEach((step, index) => {
                step.classList.toggle('active', index + 1 === currentStep);
            });

            stepIndicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index + 1 <= currentStep);
            });

            btnPrev.disabled = currentStep === 1;
            btnPrev.style.display = currentStep === 1 ? 'none' : 'block';
            
            if (currentStep === totalSteps) {
                btnNext.style.display = 'none';
                btnSubmit.style.display = 'block';
            } else {
                btnNext.style.display = 'block';
                btnSubmit.style.display = 'none';
            }

            updateSummary();
        }

        // Navigation handlers
        btnNext.addEventListener('click', () => {
            if (validateCurrentStep() && currentStep < totalSteps) {
                currentStep++;
                updateStep();
            }
        });

        btnPrev.addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                updateStep();
            }
        });

        // Form validation
        function validateCurrentStep() {
            const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (!field.value.trim()) {
                    field.focus();
                    alert('Por favor completa todos los campos requeridos');
                    return false;
                }
            }
            return true;
        }

        // Update summary
        function updateSummary() {
            const formData = new FormData(form);
            const summaryDetails = document.getElementById('summary-details');
            const priceBreakdown = document.getElementById('price-breakdown');
            
            let summary = '';
            let tablePrice = 0;
            let servicesPrice = 0;

            // Personal info
            const firstName = formData.get('firstName');
            const lastName = formData.get('lastName');
            if (firstName && lastName) {
                summary += `<p><strong>Nombre:</strong> ${firstName} ${lastName}</p>`;
            }

            // Reservation details
            const date = formData.get('date');
            const time = formData.get('time');
            const guests = formData.get('guests');
            const tableType = formData.get('tableType');

            if (date) summary += `<p><strong>Fecha:</strong> ${date}</p>`;
            if (time) summary += `<p><strong>Hora:</strong> ${time}</p>`;
            if (guests) summary += `<p><strong>Personas:</strong> ${guests}</p>`;
            if (tableType) {
                const tableSelect = document.querySelector('select[name="tableType"]');
                const selectedOption = tableSelect.querySelector(`option[value="${tableType}"]`);
                if (selectedOption) {
                    tablePrice = parseInt(selectedOption.dataset.price) || 0;
                    summary += `<p><strong>Mesa:</strong> ${selectedOption.textContent}</p>`;
                }
            }

            // Services
            const services = formData.getAll('services');
            if (services.length > 0) {
                summary += '<p><strong>Servicios:</strong></p><ul>';
                services.forEach(service => {
                    const serviceCheckbox = document.querySelector(`input[value="${service}"]`);
                    if (serviceCheckbox) {
                        const serviceCard = serviceCheckbox.nextElementSibling;
                        const serviceName = serviceCard.querySelector('.service-name').textContent;
                        const servicePrice = parseInt(serviceCheckbox.dataset.price) || 0;
                        servicesPrice += servicePrice;
                        summary += `<li>${serviceName}</li>`;
                    }
                });
                summary += '</ul>';
            }

            if (summary) {
                summaryDetails.innerHTML = summary;
                
                // Update pricing
                const subtotal = tablePrice + servicesPrice;
                const tax = subtotal * 0.1;
                const total = subtotal + tax;

                document.getElementById('table-price').textContent = `$${tablePrice}`;
                document.getElementById('services-price').textContent = `$${servicesPrice}`;
                document.getElementById('tax-price').textContent = `$${tax.toFixed(2)}`;
                document.getElementById('total-price').textContent = `$${total.toFixed(2)}`;
                
                priceBreakdown.style.display = 'block';
            } else {
                summaryDetails.innerHTML = '<p class="summary-placeholder">Completa el formulario para ver el resumen</p>';
                priceBreakdown.style.display = 'none';
            }
        }

        // Form submission
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!validateCurrentStep()) return;
            
            btnSubmit.disabled = true;
            btnSubmit.textContent = 'Procesando...';
            
            setTimeout(() => {
                alert('¡Reserva confirmada! Recibirás un email con los detalles.');
                btnSubmit.disabled = false;
                btnSubmit.textContent = 'Confirmar Reserva';
                form.reset();
                currentStep = 1;
                updateStep();
            }, 2000);
        });

        // Listen for form changes
        form.addEventListener('input', updateSummary);
        form.addEventListener('change', updateSummary);

        // Initialize
        updateStep();
    });
</script>
